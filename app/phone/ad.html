<!DOCTYPE html>
<html>
<head>
<meta charset='utf-8' />
<style>
.adunit {display:block;border:1px solide #000;width:300px;}
.mpu {height:250px;width:300px;overflow:hidden;}
.halfpage {height:600px;width:300px;overflow:hidden;}
.ad50,.ad90{width:300px;overflow:hidden;display:table;}
.ad90.fullWidth {width:auto;}
.ad50 a,.ad90 a {display:table-cell;vertical-align:middle;}
.ad50 {height:30px;}
.ad90 {height:90px;}
.hidden {display:none;}
img {border:0;max-width:100%;}
</style>
</head>

<body style="background-color:#E9DECF;">
<script>
function GetCookie(name){
    var start = document.cookie.indexOf(name+"="),
        len = start+name.length+1,
        end = document.cookie.indexOf(";",len);
    if ((!start) && (name !== document.cookie.substring(0,name.length))) {return null;}
    if (start === -1) {return null;}
    if (end === -1) {end = document.cookie.length; }
    return decodeURIComponent(document.cookie.substring(len,end));
}

function adReachability() {
  var thirdPartyVendors = {
    'dcR': '_dc',
    'mmR': '_mm',
    'szR': '_sz',
    'amR': '_am'
  };
  var adParameter = '';
  var adReachabilityStatus;
  for (var k in thirdPartyVendors) {
      if (thirdPartyVendors.hasOwnProperty(k)) {
         //user[k] = data[k];
         //console.log (k + ': ' + thirdPartyVendors[k]);
         adReachabilityStatus = GetCookie(k);
         if (adReachabilityStatus === 'reachable') {
          adParameter += '&' + thirdPartyVendors[k] + '=1';
         } else if (adReachabilityStatus === null) {
          adParameter += '&' + thirdPartyVendors[k] + '=2';
         }
      }
  }
//  console.log (adParameter);
  return adParameter;
}

var uaString=navigator.userAgent || navigator.vendor || "",deviceType="",k=window.location.href,c,adchannelId,adPositionId,adType,adType,adId,adLink,bodyWidth=document.body.offsetWidth || 0;
var matchSpecial = false;
var gSpecialAdId = '';
var gAdContent;
var parentLink = window.parent.location.href;
var testFullPage = false;
if (parentLink.indexOf('testfullpagead') > 0) {
    testFullPage = true;
}

adCode=k.replace(/^.*adtype=([0-9A-Za-z\-]+).*$/,"$1");
adId=k.replace(/^.*adid=([0-9A-Za-z]+).*$/,"$1");
if (adCode=="ad300x250-SP" || (parent.window.gSpecial === true && adCode==="ad300x250-2")) {//code for special report VFTT
    c="20400004";
    adType="mpu";
} else if (adCode=="ad300x600-SP" || (parent.window.gSpecial === true && adCode==="ad300x600")) {
    c="20400003";
    adType="halfpage";
} else if (adCode=="ad300x600") {
    c="20210005";
    //c="20210003";
    adType="halfpage";
} else if (adCode=="ad300x600-2") {
    c="20210106";
    adType="halfpage";
} else if (adCode=="ad300x250") {
    c="20210003";
    adType="mpu";
} else if (adCode=="ad300x250-2") {
    c="20210004";
    adType="mpu";
} else if (adCode=="ad300x250-e") {
    c="20200103";
    adType="mpu";
} else {
    if (/iPad/i.test(uaString)) {
    adchannelId = "2021";
    } else if (/OS [0-9]+\_/i.test(uaString) && (/iPhone/i.test(uaString) || /iPod/i.test(uaString))) {
    adchannelId = "2022";
    } else {
    adchannelId = "2023";
    }
    if (adCode==="midBanner") {
        if (bodyWidth>450) {
            adPositionId="0105";
        } else {
            adPositionId="0104";
        }
        
        adType="ad90 fullWidth";
        adchannelId = "2021";
    } else if (adCode === 'fullScreen') {
        if (bodyWidth>750) {
            adchannelId = '2021';
        }
        adPositionId = '0107';
        adType = 'hidden';
    } else if (adCode=="ad300x90") {
        adPositionId="0102";
        adType="ad90";
    } else if (adCode=="ad300x250-home") {
        adPositionId="0003";
        adType="mpu-phone";
    } else if (adCode=="ad300x250-story") {
        adPositionId="0004";
        adType="mpu-phone";
    } else if (adCode=="banner-bottom-home") {
        adPositionId="0114";
        adType="ad50";
    } else if (adCode=="banner-bottom-story") {
        adPositionId="0115";
        adType="ad50";
    } else {
        adPositionId="0101";
        adType="ad50";
    }
    c=adchannelId + adPositionId;
}

if (parent.window.gSpecialAnchors && parent.window.gSpecialAnchors.length > 0 && parent.window.gTagData.length >0) {
    //console.log (parent.window.gSpecialAnchors[0]);
    for (var i=0; i < parent.window.gSpecialAnchors.length && matchSpecial === false; i++) {
        if (parent.window.gTagData.indexOf(parent.window.gSpecialAnchors[i].tag) >=0) {
            gSpecialAdId = parent.window.gSpecialAnchors[i].adid;
            matchSpecial = true;
        }
    }
}
if (gSpecialAdId !== '' && matchSpecial === true) {
    //console.log ('speical ad!');
    if (adCode === 'ad300x600') {
        c = '0106';
        //c="20210003";
        adType = 'halfpage';
    } else if (adCode === 'ad300x250') {
        c = '0106';
        //c="20210003";
        adType = 'halfpage';
    } else {
        if (/OS [0-9]+\_/i.test(uaString) && (/iPhone/i.test(uaString) || /iPod/i.test(uaString))) {
            if (adCode === 'ad300x250-story') {
                c = '0110';
            } else {
                c = '0108';
            }
        } else  {
            if (adCode === 'ad300x250-story') {
                c = '0111';
            } else {
                c = '0109';
            }
        } 
    }
    if (c.length === 4) {
        c = gSpecialAdId + c;
    }
}//special report sponsor

//test full page ad

if (testFullPage === true && adCode === 'fullScreen') {
    c = '20530107';
}

//console.log (adType + ': ' + c);
if (adCode === 'fullScreen' && 1>2) {

} else if (c === '20210003' && 1<0) {
    //test story page top banner here

} else {
document.writeln('<div class="'+adType+'" id="ad-content"><scr'+'ipt type="text/javascript" src="http://dolphin.ftimg.net/s?z=ft&c=' + c + adReachability() + '&t='+Math.round(Math.random() * 1000000)+'" charset="gbk" ></scr'+'ipt></div>');
}
</script>

<script>



var adLinks, i, adHeight=0, gATag, gVideoTag, gImgTag, gDivTag, giFrameTag, gParentA, gParentHTML, gParentHTMLClass, gReferal;
if (document.getElementById("ad-content") && document.getElementById("ad-content").getElementsByTagName("a").length>0) {
    for (i=0;i<document.getElementById("ad-content").getElementsByTagName("a").length;i++) {
        adLinks = document.getElementById("ad-content").getElementsByTagName("a")[i].href || "";
        if (adLinks !== '') {
            adLinks = (adLinks.indexOf("?")>0) ? adLinks.replace(/\?/g,'?isad=1&') : adLinks + '?isad=1';
            document.getElementById("ad-content").getElementsByTagName("a")[i].href = adLinks;
        }
    }
}
adId = "ad-"+adId;


try {
    
    gATag = document.getElementById("ad-content").getElementsByTagName("a").length || 0;
    gVideoTag = document.getElementById("ad-content").getElementsByTagName("video").length || 0;
    giFrameTag = document.getElementById("ad-content").getElementsByTagName("iframe").length || 0;
    gImgTag = document.getElementById("ad-content").getElementsByTagName("img").length || 0;
    gDivTag = document.getElementById("ad-content").getElementsByTagName("div").length || 0;
    gParentA = parent.document.getElementById(adId).getElementsByTagName("a")[0];



    if ((parent.window.useFTScroller===1 && gVideoTag === 0 && giFrameTag === 0 && (gATag===1 || (gATag === 0 && gImgTag === 0 && gDivTag === 0))) || (window.overlayLink !== undefined && window.overlayLink !== '')) {


        if (window.overlayLink !== undefined && window.overlayLink !== '') {
            adLink = window.overlayLink;
        } else if (gATag === 1) {
            adLink = document.getElementById("ad-content").getElementsByTagName("a")[0].href;
        } else {
            adLink = '';
        }
        if (adLink.indexOf('isad=1')<0) {
            adLink = (adLink.indexOf("?")>0) ? adLink.replace(/\?/g,'?isad=1&') : adLink + '?isad=1';
        }
        gParentA.className = "ad-overlay";

//|(ftchinese\.com\/story\/)

        if (/(\index\.php\/ft\/tag\/)|(ftchinese\.com\/tag\/)|(user\.ftchinese\.com\/)|(users)|(ftchinese\.com\/story\/)|(channel\/slides\.html)/i.test(adLink)) {
            adLink = decodeURIComponent(adLink);
            gParentA.onclick=function(){
                var linkUrl;
                var linkTitle;
                var storyId;
                var ccode = '';
                if (/ftchinese\.com\/story\//i.test(adLink)) {
                    storyId = adLink.replace(/^.*\/story\/([0-9]+).*$/g,'$1');
                    parent.readstory(storyId);
                } else if (/(user\.ftchinese\.com\/)|(ftchinese\.com\/users\/gotourl)/i.test(adLink)) {
                    if (adLink.indexOf('ccode=')>0) {
                        ccode = adLink.replace(/^.*ccode=/g,'').replace(/&.*$/g,'');
                        ccode = '&ccode=' + ccode;
                        
                    }
                    linkUrl = '/index.php/users/register?i=2' + ccode;
                    linkTitle = '新用户注册';
                    parent.showchannel(linkUrl, linkTitle);
                } else if (/(channel\/slides\.html)/i.test(adLink)) {
                    parent.showchannel('/index.php/ft/channel/phonetemplate.html?channel=photo', '图辑');
                } else {
                    linkUrl = adLink.replace(/.*(\/index\.php\/ft\/tag\/.*)$/g,"$1").replace(/&format=html/g,"").replace(/&hideHead=yes/g,"");
                    linkUrl = linkUrl.replace(/^.*(\/tag\/.*$)/g,'/index.php/ft$1?i=2');
                    linkUrl = decodeURIComponent(linkUrl);
                    //console.log (linkUrl);              
                    //var linkTitle = adLink.replace(/^.*navTitle=/g,"").replace(/&.*$/g,"");
                    linkTitle = linkUrl.replace(/^.*tag\//g,'').replace(/(\?.*)$/g,'');
                    linkTitle = decodeURIComponent(linkTitle);
                    //console.log (linkTitle);
                    parent.showchannel(linkUrl, linkTitle);
                }
                return false;
            };
            gParentA.href="#";
        } else {
            gParentA.onclick=function(){};
            if (adLink.indexOf('http://dolphin.ftimg.net/') === 0) {
                //gReferal = 'http://www3.ftchinese.com/app/adsame/go.php?isad=1&url=';
                //adLink = gReferal + encodeURIComponent(adLink);
            }
            gParentA.href=adLink;
        }
    } else {
        gParentA.className = "ad-overlay hide";
    }
} catch (ignore) {
    //console.log (ignore.toString());
}
adId = adId.replace(/ad\-/g,"");
adId = 'ad-' + adId;



try {
    if ((adType === 'halfpage' || adType === 'mpu') && (gImgTag>0||gDivTag>0||giFrameTag>0)) {
        gAdContent = document.getElementById("ad-content").innerHTML;
        if (/height:600px|x600/i.test(gAdContent)) {
            adHeight = 600;
        } else if (adType === 'halfpage' && /height:250px|x250/i.test(gAdContent)){
            adHeight = 250;
        } else if (adType === 'halfpage') {
            adHeight = 600;
        } else {
            adHeight = 250;
        }
        if (adHeight === 250) {
            parent.document.getElementById(adId).className = "adiframe mpu";
            parent.document.getElementById(adId).style.height = "250px";
        } else if (adHeight === 600) {
            parent.document.getElementById(adId).className = "adiframe halfpage";
            parent.document.getElementById(adId).style.height = "600px";
            document.getElementById('ad-content').style.height = "600px";
        }
    } else { 
        //if no ad is delivered, hide the ad position altogether
        //console.log (adId + ' gDivTag: ' + gDivTag);

        /*

        gParentHTML = parent.document.getElementsByTagName("html")[0];
        gParentHTMLClass = gParentHTML.className;

        console.log (adType + adId + ': ' + parent.document.getElementById(adId).offsetTop);

        if (gDivTag>0 || gImgTag>0 || gATag>0 || gVideoTag>0 || giFrameTag>0) {
            parent.document.getElementById(adId).style.display = "block";
            gParentHTMLClass = gParentHTMLClass.replace(/ no\-banner/g,"");
        } else {
            parent.document.getElementById(adId).style.display = "none";
            gParentHTMLClass = gParentHTMLClass + ((gParentHTMLClass.indexOf("no-banner")<0) ? " no-banner" : "");
        }
        gParentHTML.className = gParentHTMLClass;
        */
    }
} catch (ignore) {
}
</script>
</body>
</html>